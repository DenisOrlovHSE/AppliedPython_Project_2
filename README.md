# Прикладной Python: Проект №2

## Описание проекта

В проекте реализован Telegram-бот, который позволяет вводить данные о своем ежедневном потреблении воды, а также определять количество потребленных калорий в продуктах и отслеживать сожженные калории через физическую активность.

## База данных

Для хранения данных используется база данных SQLite. В базе данных создаются таблицы для хранения информации о пользователях, их профиле здровья, потреблении воды и калориях за день.

### Схема данных

#### User (Пользователи)
Таблица для хранения информации о пользователях бота.

| Поле | Тип | Описание |
|------|-----|---------|
| `id` | INTEGER | Уникальный идентификатор (первичный ключ) |
| `telegram_id` | INTEGER | Уникальный идентификатор Telegram пользователя |

**Связи:**
- `health_profile` (1:1) - Профиль здоровья пользователя
- `daily_water_stats` (1:N) - Дневная статистика потребления воды
- `daily_calories_stats` (1:N) - Дневная статистика калорий

---

#### HealthProfile (Профиль здоровья)
Таблица для хранения данных о здоровье и целях пользователя. Заполняется один раз через форму регистрации.

| Поле | Тип | Описание |
|------|-----|---------|
| `id` | INTEGER | Уникальный идентификатор |
| `user_id` | INTEGER | Внешний ключ к User (уникальный) |
| `weight` | FLOAT | Вес в килограммах |
| `height` | FLOAT | Рост в сантиметрах |
| `age` | INTEGER | Возраст в годах |
| `activity` | INTEGER | Желаемая ежедневная активность в минутах |
| `city` | STRING | Город проживания |
| `calorie_goal` | INTEGER | Дневная цель по калориям в ккал |

---

#### DailyWaterStats (Дневная статистика воды)
Таблица для отслеживания ежедневного потребления воды.

| Поле | Тип | Описание |
|------|-----|---------|
| `id` | INTEGER | Уникальный идентификатор |
| `user_id` | INTEGER | Внешний ключ к User |
| `day` | DATE | Дата |
| `water_goal` | INTEGER | Цель по воде в миллилитрах |
| `water_consumed` | INTEGER | Потребленное количество воды в миллилитрах |

**Ограничения:**
- Уникальная пара (user_id, day) - один записей в день на пользователя

---

#### DailyCaloriesStats (Дневная статистика калорий)
Таблица для отслеживания ежедневного потребления и сжигания калорий.

| Поле | Тип | Описание |
|------|-----|---------|
| `id` | INTEGER | Уникальный идентификатор |
| `user_id` | INTEGER | Внешний ключ к User |
| `day` | DATE | Дата |
| `calories_goal` | INTEGER | Дневная цель по калориям в ккал |
| `calories_consumed` | INTEGER | Потребленные калории в ккал |
| `calories_burned` | INTEGER | Сожженные калории через физическую активность в ккал |

**Ограничения:**
- Уникальная пара (user_id, day) - одна запись в день на пользователя

## API сторонних сервисов

В проекте используются следующие сторонние API:
1. **FatSecret API для расчета калорийности продуктов**: Позволяет пользователям вводить названия и получать информацию о калорийности и пищевой ценности. Бесплатный тариф позволяет работать только с данными на английском языке. API авторизация работает через токен, который генерируется с использованием секретного ключа и действует 24 часа. Чтобы избежать частой регенерации токена, он кэшируется в памяти приложения (в `data/save.example.json`).
2. **Google Translator**: Реализован в виде готовой библиотеки `googletrans`, используется для перевода названий продуктов с русского на английский язык перед отправкой запроса к FatSecret API.
3. **OpenWeatherMap API для получения погодных условий**: Используется для учета погоды при расчете рекомендуемого потребления воды.

## Сервис
Сервисная часть отвечает за взаимодействия с базой данных и сторонними API. Включает в себя функции для регистрации пользователей, обновления профиля здоровья, добавления и получения статистики по воде и калориям.

Отслеживание тренировок включает в себя файл с конфигурацией упражнений и их калорийной ценностью в минуту (файл `exercises.yaml`). Пользователь может выбирать упражнения только из этого списка для учета сожженных калорий.

## Telegram-бот
Telegram-бот реализован с использованием библиотеки `aiogram`.
Реализованы следующие основные функции бота:
- Регистрация пользователей (`/start`);
- Заполнение и обновление профиля здоровья(`/set_profile`);
- Ввод потребления воды (`/log_water <количество в мл>`);
- Ввод потребленных калорий (`/log_food <название продукта>`);
- Ввод сожженных калорий через физическую активность (`/log_workout <название упражнения> <продолжительность в минутах>`);
- Просмотр статистики по воде и калориям за неделю (`/weekly_water`, `/weekly_calories`);
- Отслеживание прогресса по целям (`/progress`);
- Доступные упражнения для учета сожженных калорий (`/workouts`);
- Помощь по командам бота (`/help`).

Команды `/set_profile`, `/log_food` реализованы с помощью FSM (машина состояний) для поэтапного ввода данных пользователем с возможностью отмены ввода или возврата к предыдущему шагу.

Также реализован middleware для логирования всех входящих сообщений и команд пользователей в консоль для отладки и мониторинга работы бота.

## Развертывание проекта

HealthTracker: @healthtracker_hse_bot

Скриншоты работы бота можно найти в папке `showcase`.